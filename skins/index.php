<?php
    require_once '../config.php';

    if($Website_UseWeaponPaints == false && $Website_UseGloves == false) {
        SendToErrorPage('plugins');
        exit;
    }

    if(!isset($_SESSION['steamid'])) {
        header('Location: ../');
        exit;
    }

    if(!isset($SteamAPI_KEY) || empty($SteamAPI_KEY)) {
        SendToErrorPage('Please contact support,<br>Steam API key is not valid.');
        exit;
    }

    $conn = require_once '../includes/database.php';
    if(!isset($conn) || $conn != 1) {
        SendToErrorPage("Please contact support,<br>$conn");
        exit;
    }

    if(isset($_POST['category'])) {
        if($_POST['category'] == 'none') {
            $_SESSION['category'] = null;
        }else {
            $_SESSION['category'] = $_POST['category'];
        }

        echo "<script>if ( window.history.replaceState ) {window.history.replaceState(null, null, window.location.href);}</script>";
        unset($_POST['category']);
    }

    if(isset($_POST['defindex']) && isset($_POST['paint']) && isset($_POST['wear']) && isset($_POST['seed']) && isset($_POST['weapon_name'])) {
        if(strpos($_POST['weapon_name'], 'gloves') !== false) {
            if($_POST['weapon_name'] == 'gloves_default') {
                $state = $pdo->prepare('DELETE FROM `wp_player_gloves` WHERE `steamid` = ?');
                $state->execute([$_SESSION['steamid']]);
    
                header("Refresh:0");
                exit;
            }
    
            $state = $pdo->prepare('SELECT * FROM `wp_player_gloves` WHERE `steamid` = ?');
            $state->execute([$_SESSION['steamid']]);

            $player_skin = $state->fetch();
            if(empty($player_skin)) {
                $state = $pdo->prepare('INSERT INTO `wp_player_gloves`(`steamid`, `weapon_defindex`, `paint`) VALUES(?, ?, ?)');
                $state->execute([$_SESSION['steamid'], $_POST['defindex'], $_POST['paint']]);
            }else {
                $state = $pdo->prepare('UPDATE `wp_player_gloves` SET `paint` = ? WHERE `steamid` = ?');
                $state->execute([$_POST['paint'], $_SESSION['steamid']]);
            }
        }else {
            if($_POST['weapon_name'] == 'weapon_knife_default') {
                $state = $pdo->prepare('DELETE FROM `wp_player_knife` WHERE `steamid` = ?');
                $state->execute([$_SESSION['steamid']]);
    
                header("Refresh:0");
                exit;
            }
    
            $state = $pdo->prepare('SELECT * FROM `wp_player_skins` WHERE `steamid` = ? AND `weapon_defindex` = ?');
            $state->execute([$_SESSION['steamid'], $_POST['defindex']]);
    
            $player_skin = $state->fetch();
            if(empty($player_skin)) {
                $state = $pdo->prepare('INSERT INTO `wp_player_skins`(`steamid`, `weapon_defindex`, `weapon_paint_id`, `weapon_wear`, `weapon_seed`) VALUES(?, ?, ?, ?, ?)');
                $state->execute([$_SESSION['steamid'], $_POST['defindex'], $_POST['paint'], $_POST['wear'], $_POST['seed']]);
            }else {
                $state = $pdo->prepare('UPDATE `wp_player_skins` SET `weapon_defindex`= ?, `weapon_paint_id` = ?, `weapon_wear` = ?, `weapon_seed` = ? WHERE `steamid` = ? AND `weapon_defindex`= ?');
                $state->execute([$_POST['defindex'], $_POST['paint'], $_POST['wear'], $_POST['seed'],$_SESSION['steamid'], $_POST['defindex']]);
            }
    
            if(strpos($_POST['weapon_name'], 'knife') !== false || $_POST['weapon_name'] == 'weapon_bayonet') {
                $state = $pdo->prepare('SELECT * FROM `wp_player_knife` WHERE `steamid` = ?');
                $state->execute([$_SESSION['steamid']]);
    
                $player_knife = $state->fetch();
    
                if(empty($player_knife)) {
                    $state = $pdo->prepare('INSERT INTO `wp_player_knife`(`steamid`, `knife`) VALUES(?, ?)');
                    $state->execute([$_SESSION['steamid'], $_POST['weapon_name']]);
                }else {
                    $state = $pdo->prepare('UPDATE `wp_player_knife` SET `knife` = ? WHERE `steamid` = ?');
                    $state->execute([$_POST['weapon_name'], $_SESSION['steamid']]);
                }
            }
        }
        
        header("Refresh:0");
        exit;
    }

    if($Website_UseWeaponPaints) {
        $full_skins = json_decode(file_get_contents('skins.json'));
    }
    if($Website_UseGloves) {
        $gloves = json_decode(file_get_contents('gloves.json'));
    }

    $steamApiUserInfo = file_get_contents("http://api.steampowered.com/ISteamUser/GetPlayerSummaries/v0002/?key=$SteamAPI_KEY&steamids=".$_SESSION['steamid']);
    $UserInfo = json_decode($steamApiUserInfo)->response->players[0];

    function SendToErrorPage($msg) {
        header("Location: ../error/?msg=$msg");
        exit;
    }

    
    $weapon_types = [
        // Knifes
        'weapon_bayonet' => 'knifes',
        'weapon_knife_css' => 'knifes',
        'weapon_knife_flip' => 'knifes',
        'weapon_knife_gut' => 'knifes',
        'weapon_knife_karambit' => 'knifes',
        'weapon_knife_m9_bayonet' => 'knifes',
        'weapon_knife_tactical' => 'knifes',
        'weapon_knife_falchion' => 'knifes',
        'weapon_knife_survival_bowie' => 'knifes',
        'weapon_knife_butterfly' => 'knifes',
        'weapon_knife_push' => 'knifes',
        'weapon_knife_cord' => 'knifes',
        'weapon_knife_canis' => 'knifes',
        'weapon_knife_ursus' => 'knifes',
        'weapon_knife_gypsy_jackknife' => 'knifes',
        'weapon_knife_outdoor' => 'knifes',
        'weapon_knife_stiletto' => 'knifes',
        'weapon_knife_widowmaker' => 'knifes',
        'weapon_knife_skeleton' => 'knifes',
        'weapon_knife_kukri' => 'knifes',
        'weapon_knife_default' => 'knifes',

        // Pistols
        'weapon_deagle' => 'pistols',
        'weapon_cz75a' => 'pistols',
        'weapon_fiveseven' => 'pistols',
        'weapon_glock' => 'pistols',
        'weapon_hkp2000' => 'pistols',
        'weapon_p250' => 'pistols',
        'weapon_revolver' => 'pistols',
        'weapon_tec9' => 'pistols',
        'weapon_usp_silencer' => 'pistols',
        'weapon_elite' => 'pistols',
        'weapon_taser' => 'pistols',

        // Rifles
        'weapon_ak47' => 'rifles',
        'weapon_aug' => 'rifles',
        'weapon_famas' => 'rifles',
        'weapon_galilar' => 'rifles',
        'weapon_m4a1' => 'rifles',
        'weapon_m4a1_silencer' => 'rifles',
        'weapon_sg556' => 'rifles',

        // Smg
        'weapon_mac10' => 'smg',
        'weapon_mp5sd' => 'smg',
        'weapon_mp7' => 'smg',
        'weapon_mp9' => 'smg',
        'weapon_bizon' => 'smg',
        'weapon_p90' => 'smg',
        'weapon_ump45' => 'smg',

        // Machine guns
        'weapon_m249' => 'mg',
        'weapon_negev' => 'mg',

        // Sniper rifles
        'weapon_ssg08' => 'snipers',
        'weapon_awp' => 'snipers',
        'weapon_scar20' => 'snipers',
        'weapon_g3sg1' => 'snipers',
        
        // Shotguns
        'weapon_mag7' => 'shotguns',
        'weapon_nova' => 'shotguns',
        'weapon_sawedoff' => 'shotguns',
        'weapon_xm1014' => 'shotguns'
    ];
    
    function GetWeaponType($weapon_name) {
        global $weapon_types;
        if(!isset($weapon_types[$weapon_name])) {
            return 'knifes';
        }
        return $weapon_types[$weapon_name];
    }
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../src/logo.png" type="image/x-icon">
    <link rel="stylesheet" href="../css/main.css" type="text/css">
    <link rel="stylesheet" href="../css/skins.css" type="text/css">
    <script src="script.js" defer></script>
    <title><?= $translations->website_name; ?> - Skins</title>
</head>
<body <?= $bodyStyle ?>>

<div id="loading">
    <span></span>
</div>

<?php
if(!isset($_POST['weapon'])) {

    if($Website_UseCategories) {
        $weapon_type_select = ['','','','','','','',''];
        $weapon_type_select = [
            "gloves" => '',
            "knifes" => '',
            "pistols" => '',
            "rifles" => '',
            "smg" => '',
            "mg" => '',
            "snipers" => '',
            "shotguns" => ''
        ];

        if(isset($_SESSION['category'])) {
            $weapon_type_select[$_SESSION['category']] = "class='selected'";
        }
    }
?>
<div class="wrapper">
    <?php
    $marginTopContainer = '';
    if($Website_UseCategories) {
        $marginTopContainer = 'style="margin-top: 100px;"';
    ?>
    <header class="categories">
        <ul>
            <?php
            if($Website_UseGloves) {
            ?>
            <li><button data-action="category" data-category="gloves" <?= $weapon_type_select['gloves']; ?>>
                <svg viewBox="0 0 48 48"><path d="M37.871,16.126l-0.002,0.001c-0.111-0.266-0.273-0.516-0.49-0.733c-0.891-0.891-2.334-0.891-3.225,0   c-0.547,0.546-0.755,1.299-0.632,2.006l-0.002,0l0.004,0.011c0.031,0.175,0.084,0.345,0.157,0.51l0.643,2.076l-4.789-4.788   c-2.945-2.945-7.721-2.945-10.666,0s-2.945,7.721,0,10.667l13.465,13.465L43,28.675l-2.652-2.652l-2.326-9.293   c-0.025-0.205-0.07-0.406-0.15-0.599V16.126z"/><path d="M29.577,18.25l-0.216-0.862c-0.025-0.205-0.07-0.406-0.15-0.599v-0.004l-0.002,0.001c-0.111-0.266-0.273-0.516-0.49-0.733    c-0.537-0.538-1.276-0.745-1.974-0.633L29.577,18.25z"/><path d="M15.87,25.876c-2.945-2.946-2.945-7.721,0-10.667c0.515-0.515,1.088-0.935,1.696-1.27    c-2.534-0.704-5.363-0.064-7.356,1.929c-2.945,2.945-2.945,7.721,0,10.667L23.674,40l3.16-3.159L15.87,25.876z"/></svg>
                <span class="helpbox"><?= $translations->skins->categories->gloves; ?></span>
            </button></li>
            <?php
            }
            if($Website_UseWeaponPaints) {
            ?>
            <li><button data-action="category" data-category="knifes" <?= $weapon_type_select['knifes']; ?>>
                <svg viewBox="0 0 512 512" style="transform: scaleX(-1) rotate(10deg);"><path d="M311.96 258.5L105.55 484l-30-28.31L288.92 236.7zM139.77 417.7a7.41 7.41 0 1 0 .3 10.47 7.41 7.41 0 0 0-.3-10.47zm23.74-25.14a7.41 7.41 0 1 0 .3 10.47 7.41 7.41 0 0 0-.29-10.44zm23.76-25.11a7.41 7.41 0 1 0 .3 10.47 7.41 7.41 0 0 0-.3-10.47zm23.74-25.15a7.41 7.41 0 1 0 .3 10.47 7.41 7.41 0 0 0-.3-10.47zm23.76-25.14a7.41 7.41 0 1 0 .3 10.47 7.41 7.41 0 0 0-.3-10.47zm23.74-25.14a7.41 7.41 0 1 0 .3 10.47 7.41 7.41 0 0 0-.31-10.47zm23.74-25.14a7.41 7.41 0 1 0 .3 10.47 7.41 7.41 0 0 0-.3-10.47zM52.67 433.13l-28.26-30 225.85-206 21.71 23.02zm36.9-63.05a7.41 7.41 0 1 0-.32 10.47 7.41 7.41 0 0 0 .33-10.47zm25.2-23.7a7.41 7.41 0 1 0-.32 10.47 7.41 7.41 0 0 0 .32-10.47zm25.17-23.68a7.41 7.41 0 1 0-.32 10.47 7.41 7.41 0 0 0 .32-10.47zm25.18-23.7a7.41 7.41 0 1 0-.32 10.47 7.41 7.41 0 0 0 .32-10.5zm25.18-23.7a7.41 7.41 0 1 0-.32 10.47 7.41 7.41 0 0 0 .32-10.5zm25.18-23.7a7.41 7.41 0 1 0-.32 10.47 7.41 7.41 0 0 0 .32-10.51zm25.18-23.7a7.41 7.41 0 1 0-.32 10.47 7.41 7.41 0 0 0 .32-10.51zm63.89 1.63c12.87-10.8 25.09-20.92 37-30.79C425.04 129.57 475.68 87.63 487.59 28c-8.36 6.7-63.45 50.38-92.82 58.58l-114 119.47z"/></svg>
                <span class="helpbox"><?= $translations->skins->categories->knifes; ?></span>
            </button></li>
            <li><button data-action="category" data-category="pistols" <?= $weapon_type_select['pistols']; ?>>
                <svg viewBox="0 0 52 52" style="transform: scaleX(-1) rotate(-10deg);"><path d="M47.9818192,11.6695557h-3.0493774c0.0388794-0.1068115,0.0683594-0.218811,0.0683594-0.3391113v-2   c0-0.5522461-0.4472656-1-1-1s-1,0.4477539-1,1v2c0,0.1203003,0.029541,0.2322998,0.0684204,0.3391113H11.9324408   c0.0388794-0.1068115,0.0683594-0.218811,0.0683594-0.3391113v-2c0-0.5522461-0.4472656-1-1-1s-1,0.4477539-1,1v2   c0,0.1203003,0.029541,0.2322998,0.0684204,0.3391113h-1.517395c-1.9100337,0-3.6400142,1.0700073-4.4199824,2.7299805   l-1.6600344,3.5599976c-0.4899902,1.0300293-0.5299683,2.1900024-0.1199951,3.2600098   c0.4199829,1.1199951,1.2800293,2,2.4000247,2.4799805l0.2399902,0.1100464   c0.7099609,0.2999878,1.0800171,1.0199585,0.8800049,1.6999512L2.1618111,38.3595581   c-0.3599854,1.2199707-0.1199951,2.5200195,0.6600342,3.5499878c0.8199463,1.0999756,2.1499636,1.7600098,3.5599978,1.7600098   h5.269958c1.960022,0,3.6900024-1.2700195,4.210022-3.0700073l2.8727427-9.9317017h2.1968994   c4.4492188,0,8.0693359-3.6201172,8.0693359-8.0698242v-0.1884766h16.6409912c2.4000244,0,4.3600464-1.8699951,4.3600464-4.1699829   v-4.6099854C50.0018387,12.5495605,49.0918045,11.6695557,47.9818192,11.6695557z M20.9314651,28.6678467h-1.6184082   l1.3387451-4.6282959c0.0857544-0.2940674,0.2401733-0.5561523,0.4358521-0.7848511l2.163147,2.163147   c0.1953125,0.1953125,0.4511719,0.2929688,0.7070313,0.2929688s0.5117188-0.0976563,0.7070313-0.2929688   c0.390625-0.390625,0.390625-1.0234375,0-1.4140625l-1.3359375-1.3359375h3.671875   C26.9627151,25.9827881,24.2547073,28.6678467,20.9314651,28.6678467z"/></svg>
                <span class="helpbox"><?= $translations->skins->categories->pistols; ?></span>
            </button></li>
            <li><button data-action="category" data-category="rifles" <?= $weapon_type_select['rifles']; ?>>
                <svg viewBox="0 0 512 512" style="transform: scale(2) rotate(10deg);"><path d="M477.564,231.561c-0.62-0.972-2.023-1.592-4.434-1.997c-1.592-0.287-4.641-0.845-8.509-1.456    c-17.035-2.987-48.586-8.526-56.825-9.624c-2.096-0.279-3.813-0.342-5.415-0.342c-3.543,0-5.459,0.611-7.204,1.24    c-1.034,0.343-1.942,0.621-3.103,0.757c-0.685,0.144-1.476,0.144-2.357,0.144c-3.66,0-7.969-0.701-8.382-0.765    c-0.621-0.136-10.38-2.42-13.626-3.247c-1.035-0.216-1.943-0.359-2.708-0.359c-1.376,0-1.942,0.422-2.141,0.701l-0.144,0.207    l-0.072,0.207c0,0,0,0,0,0.071c-2.636-0.414-6.493-1.043-6.493-1.043l-2.51-0.899c-0.126-4.426-5.459-7.951-6.988-8.302    c0.071-0.207,0.152-0.423,0.152-0.62c0-1.602-4.083-7.682-9.345-7.682H234.101c0-0.144,0-0.216,0-0.216l-1.233-0.899h-1.816    v-0.216h5.261c0,0,0-2.627,0-3.598c0-0.972-0.054-1.169-1.034-1.169c-1.448,0-2.482,2.347-2.482,2.347h-2.932    c-0.189-1.033-0.954-1.727-1.862-1.727c-0.89,0-1.655,0.693-1.844,1.727h-0.567c-2.635-2.212-6.916-0.62-6.916-0.62h-2.24    l-0.54-0.558h-3.193c-1.799-2.626-3.391,0-3.391,0h-2.905v0.899h-0.81l0,0c-0.369-0.413-0.765-0.611-1.403-0.611    c-2.905,0-3.391,1.52-3.391,3.598c0,0.27,0,0.62,0,0.971c-0.126-0.071-0.423-0.144-0.621-0.144c-0.342,0-0.612,0.072-0.765,0.216    c0-0.359,0-0.701,0-0.846c0-0.827-0.144-1.241-1.295-1.241c-0.422,0-0.719,0-0.989,0c-0.072-0.071-0.072-0.135-0.144-0.207    c-0.467-0.485-1.232-0.692-2.563-0.692c-1.646,0-11.63,0.207-22.126,0.414c-10.334,0.144-20.983,0.351-22.656,0.351    c-1.178,0-2.06,0.342-2.699,0.972c-0.351,0-0.818,0-1.304,0c-1.035,0-3.247,0-3.247,2.698v-0.485c0,0-25.895,0-36.354,0    c-0.27,0-0.558,0.063-0.756,0.063c-0.072,0-0.153,0-0.225,0c-0.198,0-0.342,0.072-0.468,0.072c-0.072,0-0.144,0-0.297,0    c-0.117,0.071-0.27,0.071-0.342,0.144c-0.126,0-0.198,0-0.27,0c-0.144,0.063-0.27,0.063-0.342,0.144c-0.072,0-0.153,0-0.198,0.063    c-0.144,0-0.297,0.063-0.422,0.135c-0.072,0-0.144,0-0.216,0.071c-0.125,0.073-0.27,0.136-0.468,0.199l0,0    c-0.153,0.144-0.369,0.215-0.494,0.287c-0.072,0.072-0.072,0.072-0.144,0.072c-0.072,0.126-0.198,0.207-0.351,0.27    c0,0-0.072,0.072-0.144,0.072c-0.045,0.144-0.197,0.206-0.27,0.27c-0.072,0.072-0.072,0.072-0.126,0.145    c-0.072,0.071-0.216,0.144-0.297,0.278c-0.045,0-0.045,0.063-0.117,0.063c-0.072,0.145-0.225,0.217-0.341,0.352v0.063    c-2.167,2.356-3.346,5.819-5.685,8.311c-0.566,0.558-1.178,1.115-1.871,1.529h-0.342h-0.072c-1.376,0.756-3.049,1.17-4.992,1.17    h-0.198v0.144c-0.072,0-0.153,0.063-0.225,0.144H58.209v-2.213l-7.546-14.688c0.494-0.342,0.908-1.385,0.908-2.563    c0-1.521-0.639-2.762-1.331-2.762h-1.862h-0.081h-3.041h-0.548h-1.376c-0.71,0-1.25,1.241-1.25,2.762    c0,1.178,0.342,2.148,0.836,2.563h-0.225v0.207c0.072,0.072,1.034,5.612,0.072,9.696c0,0,0,0-0.072,0    c-0.27,0-0.684,0.071-0.684,0.071l-0.153,0.072v3.589c0,0.207-1.151,2.978-2.977,2.978v0.287h-2.482H36.2    c-1.25,0-2.212,1.655-2.212,3.732s0.962,3.805,2.212,3.805h0.198h4.425c0,0,2.779,0.342,4.308,3.741    c0.198,0,2.482,0.756,5.189,0.145c0.414,0,0.836,0,1.304,0h47.409c0.639,0.962,1.673,1.871,3.346,1.871c1.646,0,1.646,0,1.646,0    s0.225-1.602,1.332-1.602v-0.27h39.862c0.495,2.761,2.833,2.761,6.44,2.761c1.457,0,3.741,0.279,6.719,0.692    c5.531,0.756,13.923,1.943,23.808,1.943c13.995,0,23.043,1.025,28.521,3.255c1.232,0.549,2.563,0.685,3.67,0.685l0,0    c0.54,0,1.106-0.072,1.718-0.072c0.639,0,1.259-0.063,1.943-0.063c0.566,0,0.989-0.144,1.331-0.484    c0.126-0.136,0.198-0.279,0.27-0.424c1.25-0.125,1.943-0.611,2.357-1.313l0.396,0.144h0.153c0.215,0,9.488,0.486,20.408,1.044    l3.273,2.626c-0.072,1.654-0.836,8.859-5.343,18.618c-4.623,10.18-14.454,25.268-34.816,39.246l-0.125,0.072    c-0.423,0.484-0.225,0.898,0.468,2.086c0.414,0.684,1.034,1.727,1.798,2.969c1.323,2.141,3.193,5.055,5.55,8.725    c4.011,6.223,8.167,12.52,8.167,12.592l0.423,0.557l0.54-0.27c0.144-0.072,12.322-6.854,25.4-20.848    c11.09-11.838,24.869-31.139,30.4-58.009c0.837-0.063,2.141-0.063,2.779,0.63h0.27c0,2.77,0.27,5.54,1.799,6.224l0,0    c0,0,0.756,4.442,1.718,5.819c-0.071,0,1.106,0,1.106,0v-2.284c0,0-0.881-1.179,0-2.078h0.495v-1.457    c0.413-0.27,0.684-0.899,1.592,0.144c0,0,0.27,0,0.692,0c0.765,1.313,2.779,3.184,7.744,3.454    c2.015,0.072,3.957,0.216,5.756,0.287c3.391,0.198,6.566,0.414,9.84,0.414c0.611,0,1.151,0,1.79,0    c3.4-0.071,5.118-1.385,6.152-2.626c1.034,1.025,2.356,3.112,4.227,7.682c4.507,11.201,8.393,18.883,9.543,24.836    c1.106,5.973,0.567,7.971,9.84,7.07c9.273-0.973,12.322-7.609,12.125-10.738c-0.226-3.113-6.521-16.186-8.464-21.799    c-1.916-5.603-2.411-8.238-1.034-11c1.105-2.077,2.141-5.747,1.87-7.474h0.567l1.304-2.428c1.673,0.342,5.189,1.24,7.204,1.663    c0.495,0.063,0.963,0.207,1.305,0.279c0.494,2.482,4.92,4.218,11.782,6.781c2.06,0.828,4.497,1.727,6.979,2.698    c10.253,4.156,72.745,32.806,80.444,37.231c2.015,1.188,3.886,1.816,5.388,1.816c3.463,0,5.63-2.914,6.026-8.113    c0.413-8.85,7.348-39.587,8.04-42.636C477.979,234.133,478.32,232.748,477.564,231.561L477.564,231.561z M231.339,207.33    L231.339,207.33h-8.877l0,0H231.339L231.339,207.33z M221.355,211.701L221.355,211.701L221.355,211.701c-0.072,0-0.188,0-0.342,0    H221.355z M145.984,210.101L145.984,210.101L145.984,210.101h5.189h0.072c3.175-0.899,6.098-1.377,8.932-1.377    c3.049,0,5.333,0.478,7.205,0.963c1.106,0.217,1.987,0.414,2.752,0.414h7.276h0.081c2.824-0.899,5.532-1.313,7.942-1.313    c2.698,0,4.641,0.559,6.018,0.899c0.566,0.217,1.115,0.342,1.529,0.414c-0.684,0.144-0.836,0.629-0.962,0.972    c-0.144,0.413-0.27,0.898-2.356,0.898h-9.489c-0.738,0-0.819-0.063-0.891-0.27c-0.225-0.629-0.612-1.043-1.943-1.043h-11.144    c-1.322,0-1.664,0.414-1.861,1.043c-0.081,0.207-0.153,0.27-0.99,0.27h-9.048c-0.765,0-0.836-0.063-0.909-0.27    c-0.198-0.629-0.611-1.043-1.871-1.043h-4.767h-1.673v2.914h-1.925v-3.472H145.984z M106.121,210.586L106.121,210.586v-1.034    h17.701h11.441l0.468,0.477l-1.035,3.544h-28.458v-1.457h-0.117V210.586z M44.223,207.69L44.223,207.69    c0-1.602,1.322-2.915,2.896-2.915h5.612l2.923,5.811h-8.535C45.545,210.586,44.223,209.272,44.223,207.69L44.223,207.69z     M52.192,223.188L52.192,223.188c0.836-1.035,1.646-2.078,1.646-2.078h2.239H86.37c0.072,0,0.153,0.071,0.225,0.071v0.073h2.482    c-0.27,0.197-0.495,0.476-0.495,0.827c0,0.62,0.495,1.034,1.062,1.034h8.508v0.072H52.192z M105.357,223.115L105.357,223.115h0.54    c0.611,0,1.034-0.414,1.034-1.034c0-0.414-0.27-0.756-0.692-0.972l0,0h28.602h6.152v2.078h-35.635V223.115z M314.193,250.188    L314.193,250.188c-3.732,0.063-7.474-0.135-11.432-0.423c-1.798-0.063-3.714-0.206-5.729-0.27    c-4.92-0.278-5.954-2.285-6.026-2.572v-9.543c0.144-0.063,0.27-0.144,0.414-0.278c0.152-0.207,0.27-0.342,0.351-0.486    c0.144-0.207,0.342-0.485,2.554-0.485c2.356,0,7.816,0.278,10.865,0.414c1.26,0.071,2.141,0.144,2.563,0.216    c0.765,0.557,1.521,1.583,1.521,3.256c0,3.31,0.494,5.117-5.388,7.681c-0.145-0.144-0.288,0.899,1.573,0.684    c1.943-0.27,4.039-2.141,4.776-3.247c0.765-1.178,2.581-5.189,2.627-5.747l2.023-0.558c0,0,1.942-0.756,2.554-1.997h0.297v4.911    c0,0-0.765,2.968,0,5.811c0.117,0.62,0.342,0.899,0.611,1.106C317.666,249.423,316.406,250.116,314.193,250.188L314.193,250.188z"/></svg>
                <span class="helpbox"><?= $translations->skins->categories->rifles; ?></span>
            </button></li>
            <li><button data-action="category" data-category="smg" <?= $weapon_type_select['smg']; ?>>
                <svg viewBox="0 0 512 512" style="transform: scale(2) rotate(10deg);"><path d="M60.861,206.152c0,3.04,0.98,5.469,2.167,5.469h15.218v0.072c0,5.18,9.687,3.939,9.687,3.939    v-3.939v-0.072h5.118c0.144,0.62,0.342,1.169,0.566,1.727h10.452v-1.654h4.011l11.359-0.072l-0.144,0.755l2.131,3.526    c0.72,4.991,7.825,4.299,13.582,4.991l47.831,4.291c19.455,1.943,38.9,3.885,58.849,5.81c0,0.072,0.072,0.072,0.072,0.145    c0.054,0.27,0.198,0.485,0.27,0.827c0,0,0.072-0.063,0.198-0.063c0.072,0.063,0.072,0.063,0.144,0.135l-0.612,6.584l-1.601,1.241    l-0.341,1.385l2.751,0.972c-0.197,1.169-0.341,1.87-0.341,1.87s-8.095,48.443-37.92,100.16c0,0-0.765,1.313,1.305,2.563    c2.086,1.178,13.5,8.509,15.928,9.687c2.411,1.251,4.012-0.827,4.012-0.827c29.762-51.717,37.92-100.16,37.92-100.16l2.168-4.506    l3.318,0.549c1.178,0.216,2.212,0.351,2.636,0.413c0.611,4.228,1.789,11.981,2.481,12.809c0.954,1.043,1.376-0.478,1.376-0.478    l-0.692-12.043h5.883h1.52h1.403c1.106,1.106,2.284,2.771,3.104,5.118c2.158,6.296,5.063,14.472,6.862,18.483    c1.789,4.011,5.181,5.675,15.02,5.675c9.769,0,10.452,0,15.983,0c5.54,0,4.848-4.362,11.144-4.704    c6.297-0.351,7.402,2.141,7.825,3.04c0.342,0.827-6.224-14.256-6.224-14.256l-0.693,4.982l-11.09,6.791c0,0-13.896,0-19.841,0    c-5.981,0-8.319-1.259-10.335-6.791c-1.987-5.604-3.462-9.687-5.036-15.785c-0.297-1.042-0.351-1.87-0.225-2.554h3.741    c0,0,7.744,0,17.035,0c13.015,11.009-1.592,22.288,1.304,22.432c2.86,0.126,6.251-2.572,8.167-6.728    c1.943-4.209,1.179-12.106,1.179-13.42c0-1.321,1.187-2.284,1.187-2.284c5.532,0,10.649,0,14.266,0    c8.238,0,11.288-0.216,13.968-2.428l25.967,57.454l0.683,10.73c7.133,1.448,20.714-7.816,24.303-11.423    c4.992-2.905,8.581-4.991,12.889-8.58v-3.599l-28.602-45.698c-4.506-8.995-1.457-13.636,0.414-16.532h12.124    c3.589,0.136,6.565-3.327,6.565-1.25c0,2.078,1.602,1.52,2.636,0c0.684-1.034,5.531-8.58,8.58-13.501    c0.072,0,0.072-0.071,0.072-0.134c0.072,0,0.153,0,0.198,0c3.049,0,0,3.876-2.824,6.439c-2.86,2.491-4.354,7.475,2.141,8.373    c6.439,0.9,7.052-2.148,7.052-6.161c0-4.083,0-12.673,0-12.673h-4.552l0,0h-4.102v-1.313h7.771c0.197,0.413,0.27,0.692,0.27,0.692    c15.371,0,14.948,38.973,19.374,46.797c4.434,7.825,11.71,3.463,8.463-2.986c-7.618-24.212-2.438-57.445-2.438-57.445    s1.602-3.67-12.511-3.67l0,0c-3.049,0-6.593,0.485-10.819,0.485c-2.069,0-3.328,0.692-4.084,1.861v-0.683h-2.294v-0.63v-4.011    c0,0-5.729-8.374-7.941-12.106c-2.213-3.742-3.534-3.958-7.402-3.958c-3.957,0-23.412,0-23.412,0l-0.116,0.144h-0.765h-4.452    c0,0,0-0.827,0-2.212c0-1.179,0-2.771,0-4.642c0-4.011-3.247-7.267-7.331-7.267c-4.154,0-6.098,0-6.098,0    c0.072-0.208,0.072-0.414,0-0.63c0-1.583-0.963-2.141-0.963-2.141c-7.275,1.179-14.336,5.954-14.336,5.954l1.403,3.256h1.375    v0.063l1.728,5.406v0.072l-2.141,2.14h-1.448h-20.983h-92.146l-15.002,1.655h-22.306h-20.48h-4.92    c-0.621-2.626-3.517-4.56-7.132-4.56c-3.517,0-6.494,1.934-7.132,4.56h-28.035l-1.871,0.972h-2.141h-4.695h-5.486h-5.874h-2.069    v-6.854c2.339-8.023,0-16.819,0-16.819c-4.794-0.693-8.239,0-8.239,0c-5.333,6.854-4.155,16.819-4.155,16.819v6.854h0.27    c0,0-3.175,6.026-0.27,13.365v5.883c0,0-0.342,0.827-0.692,2.356h-4.992v-3.257c0,0-8.724-1.105-9.615,3.257h-15.29    C61.842,200.685,60.861,203.112,60.861,206.152L60.861,206.152z M356.879,165.795L356.879,165.795    c0,0.892-0.764,1.728-1.744,1.728c-0.963,0-1.728-0.836-1.728-1.728c0-0.971,0.765-1.735,1.728-1.735    C356.115,164.06,356.879,164.824,356.879,165.795L356.879,165.795z M107.047,191.546L107.047,191.546H108    c-0.117,1.241-0.189,4.425,0.989,6.782h-1.942V191.546z"/></svg>
                <span class="helpbox"><?= $translations->skins->categories->smg; ?></span>
            </button></li>
            <li><button data-action="category" data-category="mg" <?= $weapon_type_select['mg']; ?>>
                <svg viewBox="0 -28.5 89 89" style="transform: scale(2) rotate(10deg) scaleX(-1);"><path d="M78.624 8.704h5.632v2.912h-5.632v0.544h-10.4v-0.544h-0.704v1.28l-0.384 0.416h-0.64v1.184h1.536v-0.448h4.256v2.016h-4.256v-0.352h-1.568v0.384l-0.864 0.832h-2.496l-1.088 0.416h-14.848l-1.312-0.416h-0.32v8.512l-0.48 0.416h-8.928l-0.576-0.576v-2.016l-0.864 0.864v0.672l-0.416 0.768-1.28-0.416-0.48 0.416-12.224-3.2-0.384-0.384 0.96-0.544 0.032-0.864 0.288-1.376 0.512-1.216 1.152-1.76 0.96-1.088 0.448-0.352-0.128-0.32v-0.832l-1.824-0.832h-10.368l-4.8 2.784-0.192 1.344-0.256 0.32-2.176 0.576-0.416-0.128 0.224-2.368 0.128-3.744-0.128-2.944-0.128-1.856 0.032-0.704 0.224-0.352h1.248l0.192 0.192h0.864l0.32 0.352v0.672h14.848l0.288 0.32 2.464-0.608 0.544-0.512 0.672-0.448 0.608-0.128 0.096 0.096v0.448h0.992v-1.376l0.768-0.512h0.256v-1.152h0.672v1.152h0.608l1.696 0.992v0.896h6.368l2.112 0.8h8.448v-0.736l0.256-0.288h5.024l2.144 1.088h4.768l1.024-0.96h4.384l0.16 0.16v1.44h1.024l0.224 0.224v0.832h0.704v-0.544h10.4v0.576zM31.264 22.432l2.784-6.976-0.096-0.512-0.256-0.352-0.544-0.128h-3.84l-0.128 0.704 0.16 0.96 0.256 0.416-0.16 0.224-0.224-0.16-0.352-0.544-0.256-0.768-0.096-0.832h-0.128l-0.352 0.288-0.256 0.576 0.064 0.736 0.32 0.544 0.448 0.448-0.16 0.416h-0.672l-0.512 0.16-0.416 0.48-0.192 0.672-0.192 0.704-0.448 0.544-0.512 0.768-0.384 0.928 0.096 0.224 4.544 1.248 0.608-0.096 0.48-0.224z"></path></svg>
                <span class="helpbox"><?= $translations->skins->categories->machine_guns; ?></span>
            </button></li>
            <li><button data-action="category" data-category="snipers" <?= $weapon_type_select['snipers']; ?>>
                <svg viewBox="0 0 512 512" style="transform: scale(2.5) rotate(10deg);"><path d="M478.374,268.743c-0.071-3.111-0.152-6.089-0.197-8.715c0-0.145,0.197-5.126-0.144-9.551    c0-0.63-0.081-1.25-0.271-1.808c-0.423-2.006-1.259-2.42-1.673-2.492h-0.126c-0.072,0-0.072,0-0.072,0    c-1.673,0.207-3.399,0.414-5.145,0.558c-0.342,0-0.539,0-0.539,0c-6.026,0.342-11.63,0-11.63,0v0.828    c0.145,0.215,0.27,0.62,0.413,1.169h-0.413c0,0-2.555-4.012-5.459-4.012c-10.182,0-10.182,0-11.288,0h-4.309h-27.198    c0,0-2.978-0.126-2.978,2.015c0,0.972,0,2.078,0,3.04v1.25h-14.948v1.035h-7.896c0,0,0.08,0.898-0.756,0.773    c-0.837-0.145-1.034-0.773-1.034-0.773h-0.621c-0.144-0.198-0.288-0.343-0.485-0.343h-17.809v0.828l-1.916-0.414l-0.071-2.356    c0,0,0.071-0.962-0.918-0.962h0.081v-6.926h-11.558c0.072,0.072,0.271,0.413,0.414,0.621c-0.342-0.621-0.963-0.972-0.963-0.972    h-0.216v-0.549v-0.621h-0.495v-1.87h-4.199v1.592h-2.023v-1.52h-1.673v1.52h-1.224v-8.032h4.271l3.742,1.386h0.072h2.707    c0,0,0-0.145,0.072-0.271h0.071v-0.216h5.189c0.271,0.558,0.765,0.486,0.765,0.486h17.926c0,0,0.054-0.145,0.126-0.486h2.284    c0.423,0.63,1.106,0.972,1.871,0.972c0.989,0,1.799-0.558,2.141-1.385c0.639-1.313,1.062-3.939,1.062-6.988    c0-4.021-0.765-7.34-1.745-7.763c-0.423-0.342-0.891-0.477-1.457-0.477c-0.953,0-1.79,0.549-2.068,1.386h-2.159    c0-0.145-0.054-0.352-0.126-0.549l-6.439,0.063h-5.189h-6.225c-0.494,0-0.765,0.207-0.908,0.549h-5.046    c-0.071-0.127-0.071-0.271-0.071-0.342v-0.207h-0.072c0-0.063,0-0.063,0-0.145v-0.135h-0.414h-2.365l-3.742,1.943h-5.036    l-1.179-1.115h-5.261v1.115h-12.395c-0.081-0.145-0.279-0.351-0.495-0.558v-1.313v-0.072v-3.669c1.179-1.106,0-2.284,0-2.284    h-11.261c-0.917,1.24,0,2.284,0,2.284h0.072v2.077h-6.521v2.42h-6.224v1.188h-4.227l-15.785-4.029l-23.191,0.08v20.138    l23.191-0.071l15.785-4.012v0.072h4.227v7.475h-0.908v-1.106h-1.178v1.106h-2.555v-1.386h-17.018l0.045,2.771h7.277l-27.123,0.072    l-195.777,0.134h-1.521l-2.068-1.654h-5.756l-2.977,1.934v-0.135l-12.736,0.063c-1.718,4.434,0,9.345,0,9.345h11.513h1.223v0.071    l1.529,1.8h7.474l1.798-1.529l143.908-0.063c0,0.063,0,0.063,0,0.063c-0.414,2.779,0,14.191,0,14.191l14.688-0.071    c-0.152,0.287-0.197,0.558-0.197,0.836c0,1.251,1.232,2.222,2.752,2.222c1.529,0,2.707-0.971,2.707-2.222    c0-0.278-0.072-0.549-0.144-0.836h19.374h10.109h25.62l23.043,6.719v11l33.989,3.75v-11.504h1.87l0.828,5.964h1.385l-0.692-5.964    h1.331c0,0,2.213,5.137,5.604,5.271l10.038,0.071c0,0,7.321,0.486,8.778-4.021c0,0,2.212-0.692,2.697,2.006    c0.567,2.771,3.328,9.84,3.328,19.464c-0.081,3.525,13.374,1.438,13.374,1.438s3.445-3.795,11.343-4.074    c6.638-0.278,8.112-0.072,8.157-1.664c0.297-0.071,0.765-0.206,1.529-0.144c0,0-0.126,0.972,2.086,0.486    c2.213-0.414,14.041-12.251,18.124-12.323c4.011,0,17.512,0,17.512,0s0.423,0,0.494,0.289v0.27c0,0.827,0,3.391,0,3.391    s1.179-0.207,1.305,0.414h9.219l2.905,1.735v4.839c0,0-0.081,0.837,1.942,0.837c2.015-0.063,3.814-0.279,3.814,0.692l0.539,0.071    l3.661-0.144h8.112c0,0,5.954,2.698,7.951,2.563c0.414,0,0.639-0.135,0.711-0.351C480.048,296.293,478.941,283.35,478.374,268.743    z M40.118,249.092h-2.905c-0.953-2.428,0-5.612,0-5.612h2.905C41.179,246.385,40.118,249.092,40.118,249.092z M307.26,219.528    c-0.073,0.063-0.145,0.206-0.145,0.351h-4.623l-0.351-0.351H307.26z M259.9,248.327h-5.954l31.916-0.054L259.9,248.327z     M331.832,234.27h-28.998v-1.934v-0.207h4.209c0,0.145,0,0.27,0,0.27s-0.054,1.044,0.756,1.044c0.837,0,9.004,0,9.004,0h2.086    c0,0,0.692,0.071,0.692-0.899c0-0.072,0-0.207,0-0.414l12.251-0.072V234.27z M349.973,242.85h-0.071    c0-0.063-0.072-0.197-0.072-0.27C349.901,242.652,349.901,242.787,349.973,242.85z M359.669,272.962c0,3.058-2.51,5.54-5.486,5.54    h-9.615c-3.049,0-5.459-2.482-5.459-5.54v-0.828c0-2.968,2.41-5.469,5.459-5.469h6.44c4.425,6.44-1.871,9.283-1.943,9.697    c-0.071,0.341,0.962,0.27,0.962,0.27c3.274-1.17,3.958-4.561,3.732-6.917c-0.188-2.284-1.294-2.977-1.376-3.05h1.728    c3.049,0,5.559,2.43,5.559,5.469V272.962z M398.083,276.02c-0.351,1.025-1.034,2.141-2.096,3.319    c-1.034,0.972-1.916,1.447-1.916,1.447s-0.368,0.288-0.297,0.837l-0.341,0.207c0,0-10.38,3.247-15.569-4.641    c-5.19-7.96-1.673-12.251,3.67-12.736c0.683-0.216,0.826-0.414,0.826-1.17h1.602c0,0-0.072,1.728,1.106,1.728    c1.106,0,6.917,0.063,6.917,0.063v0.692c0,0,5.945,2.636,6.367,7.617C398.425,274.347,398.281,275.256,398.083,276.02z"/></svg>
                <span class="helpbox"><?= $translations->skins->categories->sniper_rifles; ?></span>
            </button></li>
            <li><button data-action="category" data-category="shotguns" <?= $weapon_type_select['shotguns']; ?>>
                <svg viewBox="0 -33.5 99 99" style="transform: scale(1.5) rotate(10deg) scaleX(-1);"><path d="M94.272 4.384h0.608v2.816h-0.512v2.848h-0.416v3.552h-0.416v1.152h-3.648l-0.32 0.352h-3.904l-0.16 0.832-0.192 0.416-0.352 0.16h-0.64l-0.64-0.128h-20.384l-0.736-0.128-0.128-0.384 0.288-0.416 0.416-0.64h-21.888l-0.192 0.48-0.064 0.512 0.064 0.48 0.064 0.416 0.224 0.416-0.256 0.256-0.512-0.48-0.384-0.768-0.224-0.8-0.032-0.608h-0.928l-0.192 0.576-0.192 0.672-0.096 0.672 0.032 0.512 0.448 0.384 0.512 0.256 0.16 0.256-0.032 0.352-0.224 0.352-0.48 0.16-0.736 0.128-0.352 0.192-0.288 0.288-0.32 0.608-0.096 0.48v0.576l-0.192 0.512-0.256 0.448-0.416 0.544-1.472 3.648 0.48 0.512v0.448l-0.576 0.608h-4.8l-0.832-0.224-0.032-0.736 0.128-0.288-0.224-0.864 0.256-1.952 0.704-2.208 0.896-1.888 1.056-1.568 0.672-0.672 0.416-0.48 0.224-0.672-0.064-0.512-0.384-0.672-0.64-0.48-0.64-0.256-0.896-0.16h-4.64l-0.32-0.16-0.928-0.864v-0.352h-0.256l-0.32 0.16-0.608 0.256-16.512 3.68-0.352 0.256-1.888 0.448-0.384-0.096-0.128-0.384-0.096-1.152 0.288-2.976 0.096-2.976-0.128-3.168-0.064-1.664 0.096-0.608 0.256-0.352 0.384-0.16 1.376-0.064h0.8l0.384 0.416 0.384-0.416h12.032l0.832 0.096 0.928 0.288 1.024 0.416 0.736 0.48 0.544 0.288 0.32 0.352 0.224-0.256h2.688l0.192-0.096 0.256-0.16 2.208-1.888 0.928-0.256h0.704l0.544-0.576h11.136l0.32 0.32 0.736 0.768h10.592l0.416-0.416h20.736l0.512 0.544h5.024l0.576-0.608h9.92v-0.608h0.96v1.024h0.64z"></path></svg>
                <span class="helpbox"><?= $translations->skins->categories->shotguns; ?></span>
            </button></li>
            <?php
            }
            ?>
            <h2><?= $translations->skins->choose_weapon; ?></h2>
        </ul>
    </header>
    <?php
    }
    ?>
    <div class="container" <?= $marginTopContainer; ?>>
        <div class="choose">
            <ul>
                <?php
                    if($Website_UseWeaponPaints) {
                        $state = $pdo->prepare('SELECT * FROM `wp_player_skins` WHERE `steamid` = ?');
                        $state->execute([$_SESSION['steamid']]);
                        $player_equiped = $state->fetchAll();

                        $player_weapons = [];
                        foreach($player_equiped as $weapon) {
                            $id = $weapon['weapon_defindex'];
                            $player_weapons["$id"] = $weapon;
                        }

                        $state = $pdo->prepare('SELECT `knife` FROM `wp_player_knife` WHERE `steamid` = ?');
                        $state->execute([$_SESSION['steamid']]);
                        
                        $knifeType = $state->fetch();
                        if(!empty($knifeType)) {
                            $knifeType = $knifeType['knife'];
                        }

                        foreach($full_skins as $weapon) {
                            if($Website_UseCategories && isset($_SESSION['category']) && $_SESSION['category'] == 'gloves') {
                                break;
                            }elseif($Website_UseCategories && isset($_SESSION['category']) && GetWeaponType($weapon->weapon_name) != $_SESSION['category']) {
                                continue;
                            }
                            if($weapon->paint == 0) {
                                $knifeSelectedClass = "";
                                if($weapon->weapon_name == 'weapon_knife_default' && empty($knifeType) || GetWeaponType($weapon->weapon_name) == 'knifes' && !empty($knifeType) && $weapon->weapon_name == $knifeType) {
                                    $knifeSelectedClass = "selected";
                                }
                                
                                if(isset($player_weapons["$weapon->weapon_defindex"])) {
                                    foreach($full_skins as $weaponSecond) {
                                        if($weaponSecond->weapon_defindex == $weapon->weapon_defindex && $weaponSecond->paint == $player_weapons["$weapon->weapon_defindex"]['weapon_paint_id']) {
                                            $name = explode('|', $weaponSecond->paint_name)[0];
                                            echo html_entity_decode("<li>
                                                <button class='card $knifeSelectedClass' data-action='weapon_picked' data-weapon=".$weaponSecond->weapon_name.">
                                                    <svg data-action='fullscreen' viewBox='0 0 32 32'><path d='M28,2h-6c-1.104,0-2,0.896-2,2s0.896,2,2,2h1.2l-4.6,4.601C18.28,10.921,18,11.344,18,12c0,1.094,0.859,2,2,2  c0.641,0,1.049-0.248,1.4-0.6L26,8.8V10c0,1.104,0.896,2,2,2s2-0.896,2-2V4C30,2.896,29.104,2,28,2z M12,18  c-0.641,0-1.049,0.248-1.4,0.6L6,23.2V22c0-1.104-0.896-2-2-2s-2,0.896-2,2v6c0,1.104,0.896,2,2,2h6c1.104,0,2-0.896,2-2  s-0.896-2-2-2H8.8l4.6-4.601C13.72,21.079,14,20.656,14,20C14,18.906,13.141,18,12,18z'/></svg>
                                                    <img src=".$weaponSecond->image." loading='lazy'>
                                                    <span>".$name."</span>
                                                </button>
                                            </li>");
                                            break;
                                        }
                                    }
                                    continue;
                                }

                                $name = explode('|', $weapon->paint_name)[0];
                                
                                echo "<li>
                                    <button class='card $knifeSelectedClass' data-action='weapon_picked' data-weapon=".$weapon->weapon_name.">
                                        <svg data-action='fullscreen' viewBox='0 0 32 32'><path d='M28,2h-6c-1.104,0-2,0.896-2,2s0.896,2,2,2h1.2l-4.6,4.601C18.28,10.921,18,11.344,18,12c0,1.094,0.859,2,2,2  c0.641,0,1.049-0.248,1.4-0.6L26,8.8V10c0,1.104,0.896,2,2,2s2-0.896,2-2V4C30,2.896,29.104,2,28,2z M12,18  c-0.641,0-1.049,0.248-1.4,0.6L6,23.2V22c0-1.104-0.896-2-2-2s-2,0.896-2,2v6c0,1.104,0.896,2,2,2h6c1.104,0,2-0.896,2-2  s-0.896-2-2-2H8.8l4.6-4.601C13.72,21.079,14,20.656,14,20C14,18.906,13.141,18,12,18z'/></svg>
                                        <img src=".$weapon->image." loading='lazy'>
                                        <span>".$name."</span>
                                    </button>
                                </li>";
                            }
                        }
                    }

                    if($Website_UseGloves) {
                        $state = $pdo->prepare('SELECT * FROM `wp_player_gloves` WHERE `steamid` = ?');
                        $state->execute([$_SESSION['steamid']]);
                        $player_equiped = $state->fetch();

                        $used = [];
                        foreach($gloves as $glove) {
                            if($Website_UseCategories && isset($_SESSION['category']) && $_SESSION['category'] != 'gloves') {
                                break;
                            }
                            if(in_array($glove->glove_model, $used)) {
                                continue;
                            }

                            array_push($used, $glove->glove_model);

                            if(empty($player_equiped) && $glove->glove_collection == 'gloves_default') {
                                echo "<li>
                                    <button class='card selected' data-action='weapon_picked' data-weapon=".$glove->glove_collection.">
                                        <svg data-action='fullscreen' viewBox='0 0 32 32'><path d='M28,2h-6c-1.104,0-2,0.896-2,2s0.896,2,2,2h1.2l-4.6,4.601C18.28,10.921,18,11.344,18,12c0,1.094,0.859,2,2,2  c0.641,0,1.049-0.248,1.4-0.6L26,8.8V10c0,1.104,0.896,2,2,2s2-0.896,2-2V4C30,2.896,29.104,2,28,2z M12,18  c-0.641,0-1.049,0.248-1.4,0.6L6,23.2V22c0-1.104-0.896-2-2-2s-2,0.896-2,2v6c0,1.104,0.896,2,2,2h6c1.104,0,2-0.896,2-2  s-0.896-2-2-2H8.8l4.6-4.601C13.72,21.079,14,20.656,14,20C14,18.906,13.141,18,12,18z'/></svg>
                                        <img src=".$glove->image." loading='lazy'>
                                        <span>".explode('|', $glove->paint_name)[0]."</span>
                                    </button>
                                </li>";
                            }elseif(isset($player_equiped) && !empty($player_equiped) && $player_equiped['weapon_defindex'] == $glove->glove_model) {
                                foreach($gloves as $glove_selected) {
                                    if($glove_selected->glove_model == $player_equiped['model_idx'] && $glove_selected->paint == $player_equiped['paint']) {
                                        echo "<li>
                                            <button class='card selected' data-action='weapon_picked' data-weapon=".$glove_selected->glove_collection.">
                                                <svg data-action='fullscreen' viewBox='0 0 32 32'><path d='M28,2h-6c-1.104,0-2,0.896-2,2s0.896,2,2,2h1.2l-4.6,4.601C18.28,10.921,18,11.344,18,12c0,1.094,0.859,2,2,2  c0.641,0,1.049-0.248,1.4-0.6L26,8.8V10c0,1.104,0.896,2,2,2s2-0.896,2-2V4C30,2.896,29.104,2,28,2z M12,18  c-0.641,0-1.049,0.248-1.4,0.6L6,23.2V22c0-1.104-0.896-2-2-2s-2,0.896-2,2v6c0,1.104,0.896,2,2,2h6c1.104,0,2-0.896,2-2  s-0.896-2-2-2H8.8l4.6-4.601C13.72,21.079,14,20.656,14,20C14,18.906,13.141,18,12,18z'/></svg>
                                                <img src=".$glove_selected->image." loading='lazy'>
                                                <span>".explode('|', $glove_selected->paint_name)[0]."</span>
                                            </button>
                                        </li>";
                                        break;
                                    }
                                }
                                continue;
                            }else {
                                echo "<li>
                                    <button class='card' data-action='weapon_picked' data-weapon=".$glove->glove_collection.">
                                        <svg data-action='fullscreen' viewBox='0 0 32 32'><path d='M28,2h-6c-1.104,0-2,0.896-2,2s0.896,2,2,2h1.2l-4.6,4.601C18.28,10.921,18,11.344,18,12c0,1.094,0.859,2,2,2  c0.641,0,1.049-0.248,1.4-0.6L26,8.8V10c0,1.104,0.896,2,2,2s2-0.896,2-2V4C30,2.896,29.104,2,28,2z M12,18  c-0.641,0-1.049,0.248-1.4,0.6L6,23.2V22c0-1.104-0.896-2-2-2s-2,0.896-2,2v6c0,1.104,0.896,2,2,2h6c1.104,0,2-0.896,2-2  s-0.896-2-2-2H8.8l4.6-4.601C13.72,21.079,14,20.656,14,20C14,18.906,13.141,18,12,18z'/></svg>
                                        <img src=".$glove->image." loading='lazy'>
                                        <span>".explode('|', $glove->paint_name)[0]."</span>
                                    </button>
                                </li>";
                            }
                        }
                    }
                ?>
            </ul>
        </div>
    </div>
</div>
<?php
}else {

    if($Website_UseWeaponPaints && strpos($_POST['weapon'], 'knife') !== false) {
        $state = $pdo->prepare('SELECT `knife` FROM `wp_player_knife` WHERE `steamid` = ?');
        $state->execute([$_SESSION['steamid']]);
    
        $knifeType = $state->fetch();

        if(!empty($knifeType)) {
            $knifeType = $knifeType['knife'];
        }
    }

    $currentWeapon = false;

    $weapon_skins = [];
    if(strpos($_POST['weapon'], 'gloves') !== false) {
        foreach($gloves as $glove) {
            if($glove->glove_collection == $_POST['weapon']) {
                array_push($weapon_skins, $glove);
    
                if(!$currentWeapon) {
                    $currentWeapon = $glove;
                }
            }
        }
        
        $state = $pdo->prepare('SELECT * FROM `wp_player_gloves` WHERE `steamid` = ?');
        $state->execute([$_SESSION['steamid']]);
    }else {
        foreach($full_skins as $skin) {
            if($skin->weapon_name == $_POST['weapon']) {
                array_push($weapon_skins, $skin);
    
                if($skin->paint == 0) {
                    $currentWeapon = $skin;
                }
            }
        }

        $state = $pdo->prepare('SELECT * FROM `wp_player_skins` WHERE `steamid` = ? AND `weapon_defindex` = ?');
        $state->execute([$_SESSION['steamid'], $weapon_skins[0]->weapon_defindex]);
    }

    $player_skin = $state->fetch();

    $weapon_wear = ['','','','',''];
    $weapon_seed = 0;

    if(!empty($player_skin)) {
        if(strpos($_POST['weapon'], 'gloves') !== false) {
            foreach($weapon_skins as $weapon) {
                if($player_skin['weapon_defindex'] == $weapon->glove_model && $player_skin['paint'] == $weapon->paint) {
                    $currentWeapon = $weapon;
                    break;
                }
            }
        }else {
            foreach($weapon_skins as $weapon) {
                if($player_skin['weapon_defindex'] == $weapon->weapon_defindex && $player_skin['weapon_paint_id'] == $weapon->paint) {
                    $currentWeapon = $weapon;
                    break;
                }
            }
        }
        
        if($_SESSION['category'] !== 'gloves') {
            $weapon_seed = $player_skin['weapon_seed'];
            if($player_skin['weapon_wear'] >= 0 && $player_skin['weapon_wear'] <= 0.07) {
                $weapon_wear[0] = 'selected';
            }elseif($player_skin['weapon_wear'] > 0.07 && $player_skin['weapon_wear'] <= 0.15) {
                $weapon_wear[1] = 'selected';
            }elseif($player_skin['weapon_wear'] > 0.15 && $player_skin['weapon_wear'] <= 0.38) {
                $weapon_wear[2] = 'selected';
            }elseif($player_skin['weapon_wear'] > 0.38 && $player_skin['weapon_wear'] <= 0.45) {
                $weapon_wear[3] = 'selected';
            }else {
                $weapon_wear[4] = 'selected';
            }
        }
    }
?>

<div class="wrapper">
    <div class="container">
        <nav>
            <button class="preview" data-action="weapon_choose">
                <img src="<?= $currentWeapon->image; ?>" alt="<?= $currentWeapon->weapon_name; ?>">
            </button>
            <div class="info">
                <p><?= $translations->skins->selected_weapon->weapon_selected_label; ?><br><strong><?= explode('|', $currentWeapon->paint_name)[0]; ?></strong></p>
                <button class="main-btn" data-action="weapon_choose"><?= $translations->skins->selected_weapon->choose_weapon_button; ?></button>
            </div>
            <div class="settings" <?php if($_POST['weapon'] == 'weapon_knife_default' || $_POST['weapon'] == 'gloves_default') { ?>style="display: none;"<?php } ?>>
                <div>
                    <label for="wear"><?= $translations->skins->selected_weapon->wear->label; ?></label>
                    <select name="wear" id="wear">
                        <option value="0.00"<?= $weapon_wear[0]; ?>><?= $translations->skins->selected_weapon->wear->factory_new; ?></option>
                        <option value="0.07"<?= $weapon_wear[1]; ?>><?= $translations->skins->selected_weapon->wear->minimal_wear; ?></option>
                        <option value="0.15"<?= $weapon_wear[2]; ?>><?= $translations->skins->selected_weapon->wear->field_tested; ?></option>
                        <option value="0.38"<?= $weapon_wear[3]; ?>><?= $translations->skins->selected_weapon->wear->well_worn; ?></option>
                        <option value="0.45"<?= $weapon_wear[4]; ?>><?= $translations->skins->selected_weapon->wear->battle_scarred; ?></option>
                    </select>
                </div>
                <div>
                    <label for="seed"><?= $translations->skins->selected_weapon->seed; ?></label>
                    <input type="number" value="<?= $weapon_seed; ?>" min="0" max="1000" step="1" name="seed" id="seed" placeholder="1 - 1000">
                </div>
            </div>
        </nav>
        <div class="skins">
            <h3><?= $translations->skins->selected_weapon->select_skin_label; ?></h3>
            <ul>
                <?php
                foreach($weapon_skins as $weapon) {
                    if(strpos($_POST['weapon'], 'gloves') !== false) {
                        if(empty($player_skin) && $weapon->glove_collection == 'gloves_default' || !empty($player_skin) && $weapon->paint == $player_skin['paint']) {
                            echo "<li>
                                <button class='card selected' data-action='weapon_change' data-weapon='$weapon->glove_collection' data-defindex='$weapon->glove_model' data-paint='$weapon->paint'>
                                    <svg data-action='fullscreen' viewBox='0 0 32 32'><path d='M28,2h-6c-1.104,0-2,0.896-2,2s0.896,2,2,2h1.2l-4.6,4.601C18.28,10.921,18,11.344,18,12c0,1.094,0.859,2,2,2  c0.641,0,1.049-0.248,1.4-0.6L26,8.8V10c0,1.104,0.896,2,2,2s2-0.896,2-2V4C30,2.896,29.104,2,28,2z M12,18  c-0.641,0-1.049,0.248-1.4,0.6L6,23.2V22c0-1.104-0.896-2-2-2s-2,0.896-2,2v6c0,1.104,0.896,2,2,2h6c1.104,0,2-0.896,2-2  s-0.896-2-2-2H8.8l4.6-4.601C13.72,21.079,14,20.656,14,20C14,18.906,13.141,18,12,18z'/></svg>
                                    <img src='$weapon->image' alt='$weapon->paint_name' loading='lazy'>
                                    <span>".explode('|', $weapon->paint_name)[1]."</span>
                                </button>
                            </li>";
                        }else {
                            echo "<li>
                                <button class='card' data-action='weapon_change' data-weapon='$weapon->glove_collection' data-defindex='$weapon->glove_model' data-paint='$weapon->paint'>
                                    <svg data-action='fullscreen' viewBox='0 0 32 32'><path d='M28,2h-6c-1.104,0-2,0.896-2,2s0.896,2,2,2h1.2l-4.6,4.601C18.28,10.921,18,11.344,18,12c0,1.094,0.859,2,2,2  c0.641,0,1.049-0.248,1.4-0.6L26,8.8V10c0,1.104,0.896,2,2,2s2-0.896,2-2V4C30,2.896,29.104,2,28,2z M12,18  c-0.641,0-1.049,0.248-1.4,0.6L6,23.2V22c0-1.104-0.896-2-2-2s-2,0.896-2,2v6c0,1.104,0.896,2,2,2h6c1.104,0,2-0.896,2-2  s-0.896-2-2-2H8.8l4.6-4.601C13.72,21.079,14,20.656,14,20C14,18.906,13.141,18,12,18z'/></svg>
                                    <img src='$weapon->image' alt='$weapon->paint_name' loading='lazy'>
                                    <span>".explode('|', $weapon->paint_name)[1]."</span>
                                </button>
                            </li>";
                        }
                    }else {
                        if(GetWeaponType($weapon->weapon_name) != 'knifes' && !empty($player_skin) && $weapon->paint == $player_skin['weapon_paint_id'] ||
                        $weapon->weapon_name == 'weapon_knife_default' && empty($knifeType) ||
                        GetWeaponType($weapon->weapon_name) == 'knifes' && isset($knifeType) && $weapon->weapon_name == $knifeType && $weapon->paint == $player_skin['weapon_paint_id']) {
                            echo "<li data-text='".$translations->skins->selected_weapon->already_equiped_message."'>
                                <button class='card selected' data-action='weapon_change' data-weapon='$weapon->weapon_name' data-defindex='$weapon->weapon_defindex' data-paint='$weapon->paint'>
                                    <svg data-action='fullscreen' viewBox='0 0 32 32'><path d='M28,2h-6c-1.104,0-2,0.896-2,2s0.896,2,2,2h1.2l-4.6,4.601C18.28,10.921,18,11.344,18,12c0,1.094,0.859,2,2,2  c0.641,0,1.049-0.248,1.4-0.6L26,8.8V10c0,1.104,0.896,2,2,2s2-0.896,2-2V4C30,2.896,29.104,2,28,2z M12,18  c-0.641,0-1.049,0.248-1.4,0.6L6,23.2V22c0-1.104-0.896-2-2-2s-2,0.896-2,2v6c0,1.104,0.896,2,2,2h6c1.104,0,2-0.896,2-2  s-0.896-2-2-2H8.8l4.6-4.601C13.72,21.079,14,20.656,14,20C14,18.906,13.141,18,12,18z'/></svg>
                                    <img src='$weapon->image' alt='$weapon->weapon_name' loading='lazy'>
                                    <span>".explode('|', $weapon->paint_name)[1]."</span>
                                </button>
                            </li>";
                        }else {
                            echo "<li>
                                <button class='card' data-action='weapon_change' data-weapon='$weapon->weapon_name' data-defindex='$weapon->weapon_defindex' data-paint='$weapon->paint'>
                                    <svg data-action='fullscreen' viewBox='0 0 32 32'><path d='M28,2h-6c-1.104,0-2,0.896-2,2s0.896,2,2,2h1.2l-4.6,4.601C18.28,10.921,18,11.344,18,12c0,1.094,0.859,2,2,2  c0.641,0,1.049-0.248,1.4-0.6L26,8.8V10c0,1.104,0.896,2,2,2s2-0.896,2-2V4C30,2.896,29.104,2,28,2z M12,18  c-0.641,0-1.049,0.248-1.4,0.6L6,23.2V22c0-1.104-0.896-2-2-2s-2,0.896-2,2v6c0,1.104,0.896,2,2,2h6c1.104,0,2-0.896,2-2  s-0.896-2-2-2H8.8l4.6-4.601C13.72,21.079,14,20.656,14,20C14,18.906,13.141,18,12,18z'/></svg>
                                    <img src='$weapon->image' alt='$weapon->weapon_name' loading='lazy'>
                                    <span>".explode('|', $weapon->paint_name)[1]."</span>
                                </button>
                            </li>";
                        }
                    }
                }
                ?>
            </ul>
        </div>
    </div>
</div>
<?php
}
?>

<div id="modalFullscreen">
    <button data-action="exit_fullscreen">
        <img src="https://raw.githubusercontent.com/Nereziel/cs2-WeaponPaints/main/website/img/skins/weapon_bizon_so_red_light.png">
        <svg data-action="exit_fullscreen" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24"><line x1="18" x2="6" y1="6" y2="18"/><line x1="6" x2="18" y1="6" y2="18"/></svg>
    </button>
</div>

<footer>
    <div class="wrapper">
        <a class="info" href="https://steamcommunity.com/profiles/<?= $_SESSION['steamid']; ?>" target="_blank">
            <img src="<?= $UserInfo->avatarfull ?>" alt="name">
            <p><?= str_replace('{{name}}', "<strong>$UserInfo->personaname</strong>", $translations->skins->footer->signedin); ?></p>
        </a>
        <div class="credit">
            <p>This website created by LielXD</p>
        </div>
        <a class="main-btn" href="../includes/authorize.php?signout=true" onclick="ToggleLoading();"><?= $translations->skins->footer->sign_out ?>
            <svg viewBox="0 0 24 24"><path d="M12,10c1.1,0,2-0.9,2-2V4c0-1.1-0.9-2-2-2s-2,0.9-2,2v4C10,9.1,10.9,10,12,10z"/><path d="M19.1,4.9L19.1,4.9c-0.3-0.3-0.6-0.4-1.1-0.4c-0.8,0-1.5,0.7-1.5,1.5c0,0.4,0.2,0.8,0.4,1.1l0,0c0,0,0,0,0,0c0,0,0,0,0,0    c1.3,1.3,2,3,2,4.9c0,3.9-3.1,7-7,7s-7-3.1-7-7c0-1.9,0.8-3.7,2.1-4.9l0,0C7.3,6.8,7.5,6.4,7.5,6c0-0.8-0.7-1.5-1.5-1.5    c-0.4,0-0.8,0.2-1.1,0.4l0,0C3.1,6.7,2,9.2,2,12c0,5.5,4.5,10,10,10s10-4.5,10-10C22,9.2,20.9,6.7,19.1,4.9z"/></svg>
        </a>
    </div>
</footer>

</body>
</html>
